<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>An√°lisis Avanzado de Zona de Plateau</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <h1>An√°lisis Avanzado de Zona de Plateau</h1>
        <div class="info">
            <p><strong>Nota:</strong> 
                <span id="analysisNote">El error estad√≠stico de cada medida se considera como ¬±‚àö(cuentas). El algoritmo busca el segmento con intervalo ‚â•200V que mejor se ajuste a una recta, minimizando el œá¬≤ reducido.</span>
            </p>
        </div>
        <div class="config-section">
            <h2>Configuraci√≥n del An√°lisis</h2>
            <div class="config-group">
                <h3>Tipo de Ajuste</h3>
                <div class="radio-group">
                    <label>
                        <input type="radio" name="fitType" value="linear" checked> 
                        <strong>Ajuste Lineal</strong> (y = mx + b)
                    </label>
                    <label>
                        <input type="radio" name="fitType" value="quadratic"> 
                        <strong>Ajuste Cuadr√°tico</strong> (y = ax¬≤ + bx + c)
                    </label>
                </div>
                <p class="info">El ajuste lineal es el m√©todo est√°ndar para identificar la zona de plateau. El ajuste cuadr√°tico puede capturar curvaturas leves en los datos.</p>
            </div>
            <div class="config-group">
                <h3>Par√°metros Avanzados</h3>
                <div class="config-params">
                    <div>
                        <label for="minVoltageSpan">Rango m√≠nimo de voltaje (V):</label>
                        <input type="number" id="minVoltageSpan" value="300" min="50" max="600" step="25">
                    </div>
                    <div>
                        <label for="minPoints">M√≠nimo de puntos en el segmento:</label>
                        <input type="number" id="minPoints" value="9" min="3" max="30" step="1">
                    </div>
                    <div>
                        <label for="optimizationLevel">Nivel de optimizaci√≥n (1-10):</label>
                        <input type="number" id="optimizationLevel" value="3" min="1" max="10" step="1">
                    </div>
                </div>
                <p class="info">Un mayor nivel de optimizaci√≥n acelera el c√°lculo con muchos datos, pero podr√≠a omitir algunos segmentos candidatos.</p>
            </div>
            <div class="config-group">
                <h3>Opciones de Depuraci√≥n</h3>
                <label>
                    <input type="checkbox" id="debugMode"> Modo depuraci√≥n (mostrar logs detallados)
                </label>
                <div class="debug-panel" id="debugPanel">
                    <h4>Logs de Depuraci√≥n:</h4>
                    <pre id="debugLog"></pre>
                    <button onclick="clearDebugLog()">Limpiar logs</button>
                </div>
            </div>
        </div>
        <div class="input-section">
            <h2>Ingrese los datos experimentales</h2>
            <div class="tabs">
                <div class="tab active" onclick="switchTab('manual')">Entrada Manual</div>
                <div class="tab" onclick="switchTab('file')">Carga de Archivo</div>
                <div class="tab" onclick="switchTab('example')">Datos de Ejemplo</div>
            </div>
            <div id="manualTab" class="tab-content active">
                <p>Complete la tabla con las tasas de conteo para cada voltaje:</p>
                <div class="table-container">
                    <table id="dataTable">
                        <thead>
                            <tr>
                                <th>Voltaje (V)</th>
                                <th>Cuentas</th>
                            </tr>
                        </thead>
                        <tbody id="dataTableBody">
                        </tbody>
                    </table>
                </div>
            </div>
            <div id="fileTab" class="tab-content">
                <div class="file-input-container">
                    <p>Subir datos desde archivo:</p>
                    <ul>
                        <li><strong>.txt</strong>: Un valor por l√≠nea (solo las cuentas)</li>
                        <li><strong>.csv</strong>: Formato: voltaje,cuentas (con o sin encabezado)</li>
                    </ul>
                    <input type="file" id="fileInput" accept=".txt,.csv">
                    <div class="action-buttons">
                        <button onclick="loadFile()">Cargar archivo</button>
                        <button onclick="downloadExampleFile()" class="success-btn">Descargar ejemplo</button>
                    </div>
                </div>
            </div>
            <div id="exampleTab" class="tab-content">
                <p>Seleccione un conjunto de datos de ejemplo:</p>
                <div class="action-buttons">
                    <button onclick="loadExample('gm-tube')">Contador G-M t√≠pico</button>
                    <button onclick="loadExample('noisy-data')">Datos con ruido alto</button>
                    <button onclick="loadExample('no-plateau')">Sin zona de plateau clara</button>
                </div>
                <div class="info" style="margin-top: 15px;">
                    <p><strong>Consejo:</strong> Use los datos de ejemplo para entender c√≥mo se comporta el algoritmo en diferentes escenarios.</p>
                </div>
            </div>
            <div class="action-buttons">
                <button onclick="processData()">üöÄ Procesar Datos y Encontrar Plateau</button>
                <button onclick="clearTable()" class="danger-btn">üóëÔ∏è Limpiar Tabla</button>
                <button onclick="generateRandomData()" class="warning-btn">üé≤ Generar Datos Aleatorios</button>
            </div>
            <div id="errorMessage"></div>
            <div id="warningMessage"></div>
            <div id="successMessage"></div>
        </div>
        <div class="output-section">
            <h2>Gr√°fico de Datos y Zona de Plateau</h2>
            <div id="chartContainer">
                <canvas id="myChart"></canvas>
            </div>
            <div class="action-buttons" style="margin-top: 10px;">
                <button onclick="downloadChartImage()">üíæ Descargar Gr√°fico</button>
                <button onclick="toggleChartType()">üìä Cambiar Tipo de Gr√°fico</button>
            </div>
        </div>
        <div class="results">
            <h2>Resultados del An√°lisis</h2>
            <div id="results" class="results-content">
                <p>Ingrese datos y haga clic en "Procesar Datos" para ver los resultados.</p>
            </div>
            <div class="action-buttons" style="margin-top: 15px;">
                <button onclick="exportResults()">üì§ Exportar Resultados</button>
                <button onclick="printResults()">üñ®Ô∏è Imprimir Resultados</button>
                <button onclick="copyResultsToClipboard()">üìã Copiar al Portapapeles</button>
            </div>
        </div>
    </div>
    <script src="script.js"></script>
</body>
</html>